# ğŸ„ BlackCows ì –ì†Œ ê´€ë¦¬ ì‹œìŠ¤í…œ

> **Flutter ì•±ê³¼ ì—°ë™ë˜ëŠ” ì¢…í•©ì ì¸ ì –ì†Œ ê´€ë¦¬ ë° ê¸°ë¡ ì‹œìŠ¤í…œ API**

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

BlackCowsëŠ” ë‚™ë†ì—…ì²´ë¥¼ ìœ„í•œ ì¢…í•© ê´€ë¦¬ ì‹œìŠ¤í…œìœ¼ë¡œ, ì –ì†Œ ì •ë³´ ê´€ë¦¬ì™€ ë‹¤ì–‘í•œ ìƒì„¸ ê¸°ë¡ ê´€ë¦¬ë¥¼ ì§€ì›í•˜ëŠ” RESTful API ì„œë²„ì…ë‹ˆë‹¤.

### ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

#### ğŸ® ì –ì†Œ ê¸°ë³¸ ê´€ë¦¬
- âœ… **ì –ì†Œ ë“±ë¡/ìˆ˜ì •/ì‚­ì œ** - ì´í‘œë²ˆí˜¸, ì„¼ì„œë²ˆí˜¸, ê¸°ë³¸ ì •ë³´ ê´€ë¦¬
- âœ… **ì¦ê²¨ì°¾ê¸° ì‹œìŠ¤í…œ** - í™ˆí™”ë©´ ë…¸ì¶œìš© ì –ì†Œ ì„ ë³„
- âœ… **ìƒì„¸ ì •ë³´ ê´€ë¦¬** - ì²´ì¤‘, ì‚°ì°¨, ì„±ê²©, ìœ„ì¹˜ ë“± í™•ì¥ ì •ë³´
- âœ… **ê²€ìƒ‰ ë° í†µê³„** - ì´í‘œë²ˆí˜¸ ê²€ìƒ‰, ë†ì¥ë³„ í†µê³„ ì œê³µ

#### ğŸ“Š ìƒì„¸ ê¸°ë¡ ê´€ë¦¬ (10ê°€ì§€ ìœ í˜•)
- ğŸ¥› **ì°©ìœ  ê¸°ë¡** - ì°©ìœ ëŸ‰, ìœ ì§€ë°©, ìœ ë‹¨ë°±, ì²´ì„¸í¬ìˆ˜ ë“±
- ğŸ’• **ë°œì • ê¸°ë¡** - ë°œì • ê°•ë„, ì§€ì†ì‹œê°„, í–‰ë™ ì§•í›„ ë“±
- ğŸ¯ **ì¸ê³µìˆ˜ì • ê¸°ë¡** - ì¢…ì¶• ì •ë³´, ì •ì•¡ í’ˆì§ˆ, ì„±ê³µ í™•ë¥  ë“±
- ğŸ¤± **ì„ì‹ ê°ì • ê¸°ë¡** - ê°ì • ë°©ë²•, ê²°ê³¼, ë¶„ë§Œì˜ˆì •ì¼ ë“±
- ğŸ‘¶ **ë¶„ë§Œ ê¸°ë¡** - ë¶„ë§Œ ë‚œì´ë„, ì†¡ì•„ì§€ ì •ë³´, í•©ë³‘ì¦ ë“±
- ğŸŒ¾ **ì‚¬ë£Œê¸‰ì—¬ ê¸°ë¡** - ì‚¬ë£Œ ì¢…ë¥˜, ê¸‰ì—¬ëŸ‰, ì²¨ê°€ì œ ë“±
- ğŸ¥ **ê±´ê°•ê²€ì§„ ê¸°ë¡** - ì²´ì˜¨, ì‹¬ë°•ìˆ˜, ì²´í˜•ì ìˆ˜ ë“±
- ğŸ’‰ **ë°±ì‹ ì ‘ì¢… ê¸°ë¡** - ë°±ì‹ ëª…, ì ‘ì¢…ëŸ‰, ë¶€ì‘ìš© ë“±
- âš–ï¸ **ì²´ì¤‘ì¸¡ì • ê¸°ë¡** - ì²´ì¤‘, ì²´ì²™, ì¦ì²´ìœ¨ ë“±
- ğŸ©º **ì¹˜ë£Œ ê¸°ë¡** - ì§„ë‹¨ëª…, ì‚¬ìš©ì•½ë¬¼, ì¹˜ë£Œë¹„ìš© ë“±

#### ğŸ” ë³´ì•ˆ ë° ì¸ì¦
- âœ… **JWT ê¸°ë°˜ ì‚¬ìš©ì ì¸ì¦** - Access/Refresh Token
- âœ… **ë†ì¥ë³„ ë°ì´í„° ê²©ë¦¬** - ë©€í‹°í…Œë„ŒíŠ¸ ì§€ì›
- âœ… **Firebase ë³´ì•ˆ ê·œì¹™** - ë°ì´í„° ì ‘ê·¼ ì œì–´

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
Flutter App (Client)
      â†•ï¸ HTTP/REST API
FastAPI Server (Backend)
      â†•ï¸ SDK
Firebase Firestore (Database)
      â†•ï¸ CI/CD
AWS EC2 (Production)
```

### ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

#### ğŸ® ì –ì†Œ ì •ë³´ ì»¬ë ‰ì…˜: `cows`
```json
{
  "id": "uuid",
  "ear_tag_number": "002123456789",
  "name": "ê½ƒë¶„ì´",
  "birthdate": "2022-03-15",
  "sensor_number": "1234567890123",
  "health_status": "good",
  "breeding_status": "lactating",
  "breed": "Holstein",
  "notes": "ìš°ìˆ˜í•œ ì –ì†Œ",
  "is_favorite": true,
  "farm_id": "farm_uuid",
  "owner_id": "user_uuid",
  "has_detailed_info": true,
  "detailed_info": {
    "body_info": {
      "weight": 450.5,
      "body_condition_score": 3.5
    },
    "management_info": {
      "purchase_price": 2500000,
      "barn_section": "Aë™"
    }
  },
  "created_at": "timestamp",
  "updated_at": "timestamp",
  "is_active": true
}
```

#### ğŸ“ ìƒì„¸ ê¸°ë¡ ì»¬ë ‰ì…˜: `cow_detailed_records`
```json
{
  "id": "uuid",
  "cow_id": "cow_uuid",
  "record_type": "milking",
  "record_date": "2025-06-15",
  "title": "ì°©ìœ  ê¸°ë¡ (25.5L)",
  "description": "ì •ìƒ ì°©ìœ ",
  "record_data": {
    "milk_yield": 25.5,
    "fat_percentage": 3.8,
    "protein_percentage": 3.2,
    "somatic_cell_count": 150000
  },
  "farm_id": "farm_uuid",
  "owner_id": "user_uuid",
  "created_at": "timestamp",
  "updated_at": "timestamp",
  "is_active": true
}
```

## ğŸš€ ì„¤ì¹˜ ë° ì‹¤í–‰

### 1ï¸âƒ£ í™˜ê²½ ì„¤ì •

```bash
# ë ˆí¬ì§€í† ë¦¬ í´ë¡ 
git clone https://github.com/SeulGi0117/blackcows-server.git
cd blackcows-server/backend

# ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
```

### 2ï¸âƒ£ í™˜ê²½ë³€ìˆ˜ ì„¤ì •

`.env` íŒŒì¼ ìƒì„±:
```bash
# JWT ì„¤ì •
JWT_SECRET_KEY=your-super-secret-jwt-key-here
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=7

# Firebase ì„¤ì •
FIREBASE_PROJECT_ID=your-firebase-project-id
FIREBASE_PRIVATE_KEY_ID=your-private-key-id
FIREBASE_CLIENT_EMAIL=your-service-account@project.iam.gserviceaccount.com
FIREBASE_CLIENT_ID=your-client-id
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n"
```

### 3ï¸âƒ£ Firebase ì„¤ì •

1. [Firebase Console](https://console.firebase.google.com/)ì—ì„œ í”„ë¡œì íŠ¸ ìƒì„±
2. Firestore Database í™œì„±í™”
3. ì„œë¹„ìŠ¤ ê³„ì • í‚¤ ìƒì„± ë° ë‹¤ìš´ë¡œë“œ
4. `.env` íŒŒì¼ì— Firebase ì„¤ì • ì¶”ê°€

### 4ï¸âƒ£ ì„œë²„ ì‹¤í–‰

```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰
uvicorn main:app --reload --host 0.0.0.0 --port 8000

# í”„ë¡œë•ì…˜ ì„œë²„ ì‹¤í–‰
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
```

### 5ï¸âƒ£ API ë¬¸ì„œ í™•ì¸

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc
- **Health Check**: http://localhost:8000/health

## ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸

### ğŸ” ì¸ì¦ API
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `POST` | `/auth/register` | íšŒì›ê°€ì… |
| `POST` | `/auth/login` | ë¡œê·¸ì¸ |
| `POST` | `/auth/refresh` | í† í° ê°±ì‹  |
| `GET` | `/auth/me` | ë‚´ ì •ë³´ ì¡°íšŒ |

### ğŸ® ì –ì†Œ ê´€ë¦¬ API
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `POST` | `/cows/` | ì –ì†Œ ë“±ë¡ |
| `GET` | `/cows/` | ì –ì†Œ ëª©ë¡ ì¡°íšŒ |
| `GET` | `/cows/{cow_id}` | ì –ì†Œ ìƒì„¸ ì¡°íšŒ |
| `PUT` | `/cows/{cow_id}` | ì –ì†Œ ì •ë³´ ìˆ˜ì • |
| `DELETE` | `/cows/{cow_id}` | ì –ì†Œ ì‚­ì œ |
| `POST` | `/cows/{cow_id}/favorite` | ì¦ê²¨ì°¾ê¸° í† ê¸€ |
| `GET` | `/cows/favorites/list` | ì¦ê²¨ì°¾ê¸° ëª©ë¡ |
| `GET` | `/cows/search/by-tag/{ear_tag_number}` | ì´í‘œë²ˆí˜¸ ê²€ìƒ‰ |
| `GET` | `/cows/statistics/summary` | ë†ì¥ í†µê³„ |

### ğŸ® ì –ì†Œ ìƒì„¸ì •ë³´ API
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `PUT` | `/cows/{cow_id}/details` | ìƒì„¸ì •ë³´ ì—…ë°ì´íŠ¸ |
| `GET` | `/cows/{cow_id}/details` | ìƒì„¸ì •ë³´ ì¡°íšŒ |
| `GET` | `/cows/{cow_id}/has-details` | ìƒì„¸ì •ë³´ ë³´ìœ  ì—¬ë¶€ |

### ğŸ“ ìƒì„¸ ê¸°ë¡ ê´€ë¦¬ API
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `POST` | `/detailed-records/milking` | ì°©ìœ  ê¸°ë¡ ìƒì„± |
| `POST` | `/detailed-records/estrus` | ë°œì • ê¸°ë¡ ìƒì„± |
| `POST` | `/detailed-records/insemination` | ì¸ê³µìˆ˜ì • ê¸°ë¡ ìƒì„± |
| `POST` | `/detailed-records/pregnancy-check` | ì„ì‹ ê°ì • ê¸°ë¡ ìƒì„± |
| `POST` | `/detailed-records/calving` | ë¶„ë§Œ ê¸°ë¡ ìƒì„± |
| `POST` | `/detailed-records/feed` | ì‚¬ë£Œê¸‰ì—¬ ê¸°ë¡ ìƒì„± |
| `POST` | `/detailed-records/health-check` | ê±´ê°•ê²€ì§„ ê¸°ë¡ ìƒì„± |
| `POST` | `/detailed-records/vaccination` | ë°±ì‹ ì ‘ì¢… ê¸°ë¡ ìƒì„± |
| `POST` | `/detailed-records/weight` | ì²´ì¤‘ì¸¡ì • ê¸°ë¡ ìƒì„± |
| `POST` | `/detailed-records/treatment` | ì¹˜ë£Œ ê¸°ë¡ ìƒì„± |
| `GET` | `/detailed-records/cow/{cow_id}` | ì –ì†Œë³„ ê¸°ë¡ ì¡°íšŒ |
| `GET` | `/detailed-records/{record_id}` | ê¸°ë¡ ìƒì„¸ ì¡°íšŒ |
| `DELETE` | `/detailed-records/{record_id}` | ê¸°ë¡ ì‚­ì œ |

### ğŸ“Š í†µê³„ ë° ë¶„ì„ API
| Method | Endpoint | ì„¤ëª… |
|--------|----------|------|
| `GET` | `/detailed-records/cow/{cow_id}/milking/statistics` | ì°©ìœ  í†µê³„ |
| `GET` | `/detailed-records/cow/{cow_id}/weight/trend` | ì²´ì¤‘ ë³€í™” ì¶”ì´ |
| `GET` | `/detailed-records/cow/{cow_id}/reproduction/timeline` | ë²ˆì‹ íƒ€ì„ë¼ì¸ |
| `GET` | `/detailed-records/cow/{cow_id}/summary` | ì –ì†Œ ê¸°ë¡ ìš”ì•½ |

## ğŸ’» Flutter ì•± ì—°ë™ ì˜ˆì‹œ

### ì –ì†Œ ë“±ë¡
```dart
Future<Map<String, dynamic>> registerCow() async {
  final response = await http.post(
    Uri.parse('$baseUrl/cows/'),
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer $accessToken',
    },
    body: json.encode({
      'ear_tag_number': '002123456789',
      'name': 'ê½ƒë¶„ì´',
      'birthdate': '2022-03-15',
      'sensor_number': '1234567890123',
      'health_status': 'good',
      'breeding_status': 'lactating',
      'breed': 'Holstein',
    }),
  );
  return json.decode(response.body);
}
```

### ìƒì„¸ì •ë³´ ì—…ë°ì´íŠ¸
```dart
Future<Map<String, dynamic>> updateCowDetails(String cowId) async {
  final response = await http.put(
    Uri.parse('$baseUrl/cows/$cowId/details'),
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer $accessToken',
    },
    body: json.encode({
      'body_weight': 450.5,
      'lactation_number': 3,
      'temperament': 'gentle',
      'barn_section': 'Aë™',
      'stall_number': 'A-15',
      'purchase_price': 2500000,
    }),
  );
  return json.decode(response.body);
}
```

### ì°©ìœ  ê¸°ë¡ ìƒì„±
```dart
Future<Map<String, dynamic>> createMilkingRecord(String cowId) async {
  final response = await http.post(
    Uri.parse('$baseUrl/detailed-records/milking'),
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer $accessToken',
    },
    body: json.encode({
      'cow_id': cowId,
      'record_date': '2025-06-15',
      'milk_yield': 25.5,
      'fat_percentage': 3.8,
      'protein_percentage': 3.2,
      'somatic_cell_count': 150000,
      'milking_session': 1,
    }),
  );
  return json.decode(response.body);
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸

### API í…ŒìŠ¤íŠ¸ ì‹¤í–‰
```bash
# Python í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
python tests/api_test_examples.py

# íŠ¹ì • í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python -m pytest tests/test_cow_api.py
```

### Postman í…ŒìŠ¤íŠ¸ ì»¬ë ‰ì…˜

1. **í™˜ê²½ë³€ìˆ˜ ì„¤ì •**:
   - `base_url`: `http://localhost:8000`
   - `access_token`: (ë¡œê·¸ì¸ì—ì„œ ë°›ì€ í† í°)

2. **í…ŒìŠ¤íŠ¸ ìˆœì„œ**:
   ```
   POST /auth/login â†’ access_token ì €ì¥
   POST /cows/ â†’ cow_id ì €ì¥
   PUT /cows/{{cow_id}}/details
   POST /detailed-records/milking
   GET /detailed-records/cow/{{cow_id}}
   ```

## ğŸš€ ë°°í¬

### AWS EC2 ìë™ ë°°í¬

GitHub Actionsë¥¼ í†µí•œ ìë™ ë°°í¬ê°€ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

1. **GitHubì— í‘¸ì‹œ** â†’ ìë™ìœ¼ë¡œ EC2ì— ë°°í¬
2. **ë°°í¬ ê³¼ì •**:
   - ì½”ë“œ ì—…ë°ì´íŠ¸
   - ì˜ì¡´ì„± ì„¤ì¹˜
   - í™˜ê²½ë³€ìˆ˜ ì„¤ì •
   - ì„œë²„ ì¬ì‹œì‘
   - í—¬ìŠ¤ì²´í¬ í™•ì¸

### ìˆ˜ë™ ë°°í¬

```bash
# EC2 ì„œë²„ ì ‘ì†
ssh -i your-key.pem ubuntu@52.78.212.96

# ì½”ë“œ ì—…ë°ì´íŠ¸
cd ~/blackcows-server
git pull

# ì„œë²„ ì¬ì‹œì‘
sudo systemctl restart blackcows-server
```

## ğŸ”§ ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

### í•„ìˆ˜ Firestore ì¸ë±ìŠ¤

Firebase Consoleì—ì„œ ë‹¤ìŒ ë³µí•© ì¸ë±ìŠ¤ë“¤ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤:

1. **ì –ì†Œ ëª©ë¡ ì¡°íšŒìš©**:
   - `farm_id` (ì˜¤ë¦„ì°¨ìˆœ) + `is_active` (ì˜¤ë¦„ì°¨ìˆœ) + `created_at` (ë‚´ë¦¼ì°¨ìˆœ)

2. **ì¦ê²¨ì°¾ê¸° ì¡°íšŒìš©**:
   - `farm_id` (ì˜¤ë¦„ì°¨ìˆœ) + `is_favorite` (ì˜¤ë¦„ì°¨ìˆœ) + `is_active` (ì˜¤ë¦„ì°¨ìˆœ)

3. **ìƒì„¸ ê¸°ë¡ ì¡°íšŒìš©**:
   - `cow_id` (ì˜¤ë¦„ì°¨ìˆœ) + `farm_id` (ì˜¤ë¦„ì°¨ìˆœ) + `record_type` (ì˜¤ë¦„ì°¨ìˆœ) + `record_date` (ë‚´ë¦¼ì°¨ìˆœ)

4. **ë‚ ì§œë³„ ê¸°ë¡ ì¡°íšŒìš©**:
   - `farm_id` (ì˜¤ë¦„ì°¨ìˆœ) + `is_active` (ì˜¤ë¦„ì°¨ìˆœ) + `record_date` (ë‚´ë¦¼ì°¨ìˆœ)

## ğŸ“± Flutter ì•± í™”ë©´ êµ¬ì„±

### 1. í™ˆ í™”ë©´
- âœ… ì¦ê²¨ì°¾ê¸°ëœ ì –ì†Œ ëª©ë¡ í‘œì‹œ
- âœ… ìµœê·¼ ê¸°ë¡ ìš”ì•½ í‘œì‹œ
- âœ… ë†ì¥ í†µê³„ ëŒ€ì‹œë³´ë“œ

### 2. ì†Œ ê´€ë¦¬ íƒ­
- âœ… ì „ì²´ ì –ì†Œ ëª©ë¡
- âœ… ì¦ê²¨ì°¾ê¸° ë³„ ì•„ì´ì½˜
- âœ… ê²€ìƒ‰ ë° í•„í„°ë§
- âœ… ì –ì†Œ ìƒì„¸ ì •ë³´ í™”ë©´

### 3. ê¸°ë¡ ê´€ë¦¬ íƒ­
- âœ… 10ê°€ì§€ ìƒì„¸ ê¸°ë¡ ìœ í˜•ë³„ ì…ë ¥ í¼
- âœ… ë‚ ì§œ ì„ íƒê¸° ë° ìœ íš¨ì„± ê²€ì‚¬
- âœ… ê¸°ë¡ ëª©ë¡ ë° í†µê³„ í™”ë©´

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

- **Backend**: FastAPI 0.115+, Python 3.11+
- **Database**: Firebase Firestore
- **Authentication**: JWT (JSON Web Tokens)
- **Deployment**: AWS EC2, GitHub Actions
- **Documentation**: Swagger UI, ReDoc

## ğŸ“„ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” [MIT ë¼ì´ì„ ìŠ¤](LICENSE) í•˜ì— ìˆìŠµë‹ˆë‹¤.

## ğŸ¤ ê¸°ì—¬í•˜ê¸°

1. Fork the Project
2. Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3. Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to the Branch (`git push origin feature/AmazingFeature`)
5. Open a Pull Request

- **ê°œë°œì**: SeulGi
